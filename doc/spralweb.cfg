\Preamble{xhtml,mathml}
\usepackage{etoolbox}

% Setup header, add scripts for MathJax
\Configure{VERSION}{}
\Configure{DOCTYPE}{\HCode{<!DOCTYPE html>\Hnewline}}
\Configure{@HEAD}{}
\Configure{@HEAD}{\HCode{<meta charset="UTF-8" />\Hnewline}}
\Configure{@HEAD}{\HCode{<link
         rel="stylesheet" type="text/css"
         href="\expandafter\csname aa:CssFile\endcsname" />\Hnewline}}
\Configure{@HEAD}{\HCode{<link
         rel="stylesheet" type="text/css"
         href="spral.custom.css" />\Hnewline}}
\Configure{@HEAD}{\HCode{<script type="text/javascript"\Hnewline
src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"\Hnewline
></script>\Hnewline}}
\Configure{@HEAD}{\HCode{<style type="text/css">\Hnewline
  .MathJax_MathML {text-indent: 0;}\Hnewline
</style>\Hnewline}}
\Configure{@HEAD}{\HCode{<script type="text/javascript">\Hnewline
   MathJax.Hub.Config({\Hnewline
      "HTML-CSS": {\Hnewline
         extensions: ["handle-floats.js"]\Hnewline
      }\Hnewline
   });\Hnewline
</script>\Hnewline}}
% Add jQuery library
\Configure{@HEAD}{\HCode{<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>\Hnewline}}
\Configure{@HEAD}{\HCode{<script src="spral.js" type="text/javascript"></script>\Hnewline}}

% Do layout, including forcing a TOC at top of page
\CutAt{chapter}
\Configure{@BODY}{\HCode{\Hnewline<div id="wrapper">\Hnewline}}
\Configure{@BODY}{\HCode{\Hnewline
   <div id="pgHeader">\Hnewline
      <img id="mainLogo" src="/images/template/stfcLogo.png" alt="STFC Logo" />\Hnewline
   </div> <!-- pgHeader -->\Hnewline
}}
\Configure{chapter}
   {\tableofcontents\HCode{\Hnewline<div id="pkgHeader">\Hnewline<h1>}}
   {}
   {}
   {\HCode{</h1>\Hnewline</div> <!-- pkgHeader -->\Hnewline<div id="pgContent">\Hnewline}}
\Configure{@/BODY}{\HCode{\Hnewline</div> <!--pgContent-->\Hnewline}}
\Configure{@/BODY}{\HCode{\Hnewline</div> <!--wrapper-->\Hnewline}}

% Disable nest/prev/up/etc.
\Configure{crosslinks+}{}{}{}{}

% Add Logo at top of TOC
\newbool{CHAPTERUL}
\newbool{SECTIONUL}
\Configure{tableofcontents}
   {\IgnorePar\EndP\HCode{<div class="TOC">\Hnewline<a class="nounderline" href="/spral/"><h1>SPRAL</h1></a>\Hnewline<ul id="tocMasterUL">\Hnewline}\boolfalse{CHAPTERUL}\IgnorePar}
   {}
   {
      \IgnorePar
      \HCode{</ul></li>\Hnewline</ul>\Hnewline</div>\Hnewline}
      \HCode{<script type="text/javascript">\Hnewline
         $(document).ready( spralDocReady );\Hnewline
         </script>\Hnewline
      }
      \ShowPar
   }
   {\HCode{<br />}}
   {}
% Make Package level entries expandable in TOC
\ConfigureToc{chapter}
   {\ifbool{SECTIONUL}{\HCode{</ul></li>\Hnewline}}{}\boolfalse{SECTIONUL}\ifbool{CHAPTERUL}{\HCode{</ul></li>\Hnewline}}{}\boolfalse{CHAPTERUL}\HCode{<li class="toc_chapter"><span class="toc_rArrow toc_indicator"></span><b>}}
   {~}
   {}
   {\HCode{</b>\Hnewline<ul>\Hnewline}\booltrue{CHAPTERUL}}
\ConfigureToc{section}
   {\ifbool{SECTIONUL}{\HCode{</ul></li>\Hnewline}}{}\boolfalse{SECTIONUL}\HCode{<li>}}
   {~}
   {}
   {\HCode{\Hnewline<ul>\Hnewline}\booltrue{SECTIONUL}}
\ConfigureToc{subsection}
   {\HCode{<li>}}
   {~}
   {}
   {\HCode{</li>\Hnewline}}

\begin{document}

\EndPreamble
